# 高级配置

<cite>
**本文档中引用的文件**   
- [app.py](file://app.py)
- [config.py](file://config.py)
- [InsightEngine/tools/sentiment_analyzer.py](file://InsightEngine/tools/sentiment_analyzer.py)
- [ReportEngine/report_template/企业品牌声誉分析报告模板.md](file://ReportEngine/report_template/企业品牌声誉分析报告模板.md)
- [ReportEngine/utils/config.py](file://ReportEngine/utils/config.py)
- [InsightEngine/utils/config.py](file://InsightEngine/utils/config.py)
- [MediaEngine/utils/config.py](file://MediaEngine/utils/config.py)
- [QueryEngine/utils/config.py](file://QueryEngine/utils/config.py)
- [MindSpider/config.py](file://MindSpider/config.py)
</cite>

## 目录
1. [统一配置管理](#统一配置管理)
2. [接入LLM提供商](#接入llm提供商)
3. [更改情感分析模型](#更改情感分析模型)
4. [扩展系统功能](#扩展系统功能)
5. [总结](#总结)

## 统一配置管理

BettaFish系统通过根目录下的`.env`文件实现所有LLM和数据库配置的集中管理。该文件作为全局配置源，被系统内各子模块继承和使用。当系统启动时，主应用`app.py`会优先读取`.env`文件中的环境变量，并通过`config.py`中的`Settings`类进行统一加载和管理。

配置的继承机制基于`pydantic-settings`库，各子模块（如InsightEngine、MediaEngine等）通过定义各自的`config.py`文件，从根目录的`.env`文件中自动加载所需配置。例如，`InsightEngine/utils/config.py`和`MediaEngine/utils/config.py`都通过`env_file`参数指向项目根目录的`.env`文件，确保配置的一致性。

**Section sources**
- [app.py](file://app.py#L83-L125)
- [config.py](file://config.py#L18-L21)
- [InsightEngine/utils/config.py](file://InsightEngine/utils/config.py#L11-L14)
- [MediaEngine/utils/config.py](file://MediaEngine/utils/config.py#L11-L14)

## 接入LLM提供商

BettaFish系统支持任何兼容OpenAI API格式的LLM服务。用户可以通过修改`.env`文件中的`BASE_URL`和`MODEL_NAME`来接入不同的LLM提供商。

在`config.py`中，每个引擎（如Insight Engine、Media Engine）都有对应的API密钥、基础URL和模型名称配置。例如，`INSIGHT_ENGINE_BASE_URL`和`INSIGHT_ENGINE_MODEL_NAME`用于配置Insight Engine的LLM服务。用户只需将`INSIGHT_ENGINE_BASE_URL`设置为所选提供商的API端点，并将`INSIGHT_ENGINE_MODEL_NAME`设置为对应模型的名称即可。

```env
# 示例：接入自定义LLM提供商
INSIGHT_ENGINE_API_KEY=your_custom_api_key
INSIGHT_ENGINE_BASE_URL=https://api.your-llm-provider.com/v1
INSIGHT_ENGINE_MODEL_NAME=your-model-name
```

**Section sources**
- [config.py](file://config.py#L44-L47)
- [ReportEngine/llms/base.py](file://ReportEngine/llms/base.py#L40-L58)
- [InsightEngine/llms/base.py](file://InsightEngine/llms/base.py#L39-L55)

## 更改情感分析模型

系统的情感分析功能由`InsightEngine/tools/sentiment_analyzer.py`文件中的`WeiboMultilingualSentimentAnalyzer`类实现。用户可以通过修改该文件中的`model_type`来切换情感分析模型。

在`sentiment_analyzer.py`中，`initialize`方法负责加载情感分析模型。默认情况下，系统使用`tabularisai/multilingual-sentiment-analysis`模型。用户可以通过修改`model_name`变量来指定其他模型。

```python
# 在sentiment_analyzer.py中修改模型
model_name = "your-custom-model-name"
```

此外，用户还可以通过设置`SENTIMENT_ANALYSIS_ENABLED`为`False`来禁用情感分析功能。

**Section sources**
- [InsightEngine/tools/sentiment_analyzer.py](file://InsightEngine/tools/sentiment_analyzer.py#L186-L187)
- [InsightEngine/tools/sentiment_analyzer.py](file://InsightEngine/tools/sentiment_analyzer.py#L31-L32)

## 扩展系统功能

### 接入自定义业务数据库

用户可以通过修改`config.py`文件中的数据库配置来接入自定义业务数据库。在`config.py`中，`DB_DIALECT`、`DB_HOST`、`DB_PORT`、`DB_USER`、`DB_PASSWORD`和`DB_NAME`等字段用于配置数据库连接信息。

此外，用户还可以在`InsightEngine/utils/db.py`中创建新的数据访问工具，以支持自定义数据库的查询和操作。

```python
# 示例：在db.py中添加新的数据访问工具
async def fetch_custom_data(query: str):
    engine = get_async_engine()
    async with engine.connect() as conn:
        result = await conn.execute(text(query))
        return result.mappings().all()
```

**Section sources**
- [config.py](file://config.py#L33-L39)
- [InsightEngine/utils/db.py](file://InsightEngine/utils/db.py#L28-L46)

### 自定义报告模板

用户可以通过在`ReportEngine/report_template/`目录下添加新的`.md`文件来创建自定义报告模板。系统会自动识别该目录下的所有模板文件，并在生成报告时提供选择。

例如，用户可以创建一个名为`自定义报告模板.md`的文件，并定义报告的结构和内容。

```markdown
### **自定义报告模板**

- **1.0 摘要与核心发现**
  - 1.1 核心指标
  - 1.2 主要结论
- **2.0 详细分析**
  - 2.1 数据趋势
  - 2.2 用户反馈
```

**Section sources**
- [ReportEngine/report_template/企业品牌声誉分析报告模板.md](file://ReportEngine/report_template/企业品牌声誉分析报告模板.md)
- [ReportEngine/utils/config.py](file://ReportEngine/utils/config.py#L59)

## 总结

BettaFish系统提供了灵活的配置和扩展机制，允许开发者深度定制系统功能。通过`.env`文件统一管理配置，支持多种LLM提供商，可切换情感分析模型，并可通过修改配置和添加模板来扩展系统功能。

**Section sources**
- [config.py](file://config.py)
- [InsightEngine/tools/sentiment_analyzer.py](file://InsightEngine/tools/sentiment_analyzer.py)
- [ReportEngine/report_template/企业品牌声誉分析报告模板.md](file://ReportEngine/report_template/企业品牌声誉分析报告模板.md)